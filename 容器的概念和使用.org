#+title: 容器的概念和使用
#+author: CYQ
#+data:<2025-12-12 五>
#+LANGUAGE: zh-CN
#+html_head: <link rel="stylesheet" type="text/css" href="./css/worg-classic .css"/>
#+options: num:t toc:4 author:t date:t

#+TITLE: 容器的概念和使用

* 一、基本概念

**1. 什么是容器？**
- 容器是一种 *操作系统级别的虚拟化技术*，用于将应用程序及其依赖（如库、配置、运行时等）打包成一个 *轻量、可移植、自包含* 的运行单元。
- 容器在 *宿主机操作系统内核之上* 运行，通过命名空间（Namespaces）和控制组（Cgroups）实现资源隔离与限制。

**2. 容器 vs 虚拟机（VM）**

| 特性             | 容器                              | 虚拟机（VM）                     |
|------------------+-----------------------------------+----------------------------------|
| 隔离方式         | 进程级（Namespaces + Cgroups）    | 硬件级（Hypervisor）             |
| 内核             | 共享宿主机内核                    | 每个 VM 运行独立操作系统内核     |
| 启动速度         | 秒级                              | 分钟级                           |
| 资源开销         | 低                                | 高                               |
| 可移植性         | 高（“一次构建，到处运行”）        | 中                               |
| 典型代表         | Docker, Podman, containerd        | VMware, VirtualBox, Hyper-V      |

**3. 核心技术（Linux）**
- *Namespaces*：隔离 PID、网络、挂载点、用户、UTS（主机名）等。
- *Cgroups*：限制和监控 CPU、内存、磁盘 I/O 等资源使用。
- *UnionFS（如 OverlayFS）*：支持分层镜像，实现高效构建与存储。

* 二、容器使用流程（以 Docker 为例）

**1. 编写 =Dockerfile=**
#+begin_src dockerfile
FROM python:3.9-slim
WORKDIR /app
COPY . /app
RUN pip install -r requirements.txt
EXPOSE 8000
CMD ["python", "app.py"]
#+end_src

**2. 构建镜像**
#+begin_src sh
docker build -t my-app:1.0 .
#+end_src

**3. 运行容器**
#+begin_src sh
docker run -d -p 8000:8000 --name my-app-container my-app:1.0
#+end_src

**4. 常用管理命令**
#+begin_src sh
docker ps                # 查看运行中的容器
docker logs <容器ID>     # 查看日志
docker stop <容器ID>     # 停止容器
docker rm <容器ID>       # 删除容器
docker images            # 列出本地镜像
docker rmi <镜像ID>      # 删除镜像
#+end_src

* 三、主要优势
- ✅ *环境一致性*：消除“在我机器上能跑”的问题。
- ✅ *快速启动与部署*：适合 CI/CD 和弹性伸缩。
- ✅ *资源高效*：比 VM 更节省系统资源。
- ✅ *标准化交付*：通过镜像实现应用打包与分发。
- ✅ *生态成熟*：集成 DevOps、云原生工具链（如 Kubernetes、Helm）。

* 四、常用工具与平台

| 工具/平台          | 说明 |
|--------------------+------|
| *Docker*           | 最流行的容器引擎，开发者友好 |
| *Podman*           | 无守护进程、支持 rootless 的 Docker 替代品 |
| *containerd*       | CNCF 毕业项目，Kubernetes 默认运行时 |
| *Kubernetes (K8s)* | 容器编排平台，用于大规模容器集群管理 |
| *Docker Compose*   | 本地多容器应用编排（开发/测试环境） |

* 五、典型使用场景
1. *微服务架构*：每个服务独立容器化，便于开发、测试与部署。
2. *CI/CD 流水线*：在容器中执行构建、测试、发布任务。
3. *本地开发环境*：通过 =docker-compose.yml= 快速搭建数据库、Redis、消息队列等依赖。
4. *云原生应用*：结合 Kubernetes 实现自动扩缩容、滚动更新、服务发现等。

* 六、注意事项
- *持久化数据*：容器本身是临时的，需通过 *卷（Volume）* 或绑定挂载（Bind Mount）保存数据。
- *安全性*：
  - 避免以 =root= 用户运行容器。
  - 使用可信基础镜像，定期扫描漏洞（如 Trivy、Clair）。
- *日志与监控*：集成集中式日志（如 ELK、Loki）和指标监控（如 Prometheus）。
- *不要滥用*：容器不是虚拟机，不适合长期交互式操作或运行多个主进程。

> 📌 *最佳实践*：一个容器只运行一个主进程（Single Process Model）。
